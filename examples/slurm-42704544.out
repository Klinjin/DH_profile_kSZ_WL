/global/u1/l/lindajin/virtualenvs/env1/lib/python3.11/site-packages/jaxlib/plugin_support.py:71: RuntimeWarning: JAX plugin jax_cuda12_plugin version 0.6.1 is installed, but it is not compatible with the installed jaxlib version 0.7.1, so it will not be used.  warnings.warn(ðŸŒŒ Physics-Informed Neural Network Training==================================================ðŸ“Š GP Benchmark: 80.6% test MAPE (severe overfitting from 29% training)ðŸŽ¯ NN Target: <80% test MAPE + good generalizationðŸš€ Physics-Informed Neural Network Training Demo============================================================ðŸ“Š Demo Configuration:   â€¢ Simulations: 50 (scales to 1000+ for production)   â€¢ Filter: CAP (kinetic SZ)   â€¢ Particle: gas   â€¢ Expected training time: 10-20 minutes (scales to 2-8 hours)   â€¢ Architecture: Simplified for convergence (physics constraints disabled initially)ðŸ§  Model Architecture (Simplified for Convergence):   â€¢ Physics constraints: False, False, False   â€¢ Hidden layers: [64, 32]   â€¢ Uncertainty method: single   â€¢ Activation: reluLoading data for 50 simulations...Getting mean gas profiles with CAP filter for 50 simulations...Finished getting mean profiles from 50 simulations.Output shape: (50, 21) vs individual halo shape would be (n_halos*50, 21)Raw data loaded:  - Profiles: (50, 21)  - Masses: (50,)  - Params: (50, 35)  - PkRatio: (50, 79)Applying data transformations...Log mass range: [13.03, 14.22]âœ… Features normalized (zero mean, unit variance)Final data shapes:  - Features: (50, 115)  - Targets: (50, 21)Creating train/validation/test splits...Split created:  - Train: 40 samples (80.0%)  - Val:   5 samples (10.0%)  - Test:  5 samples (10.0%)âœ… DataLoader initialized:  - Dataset size: 50 samples, 115 features  - Train/Val/Test: 40/5/5  - Batch size: 32ðŸ“Š Dataset Information:   â€¢ Total samples: 50   â€¢ Features: 115 (35 cosmo + 1 mass + 79 PK)   â€¢ Target radius bins: 21   â€¢ Train/Val/Test: 40/5/5ðŸ–¥ï¸  JAX Device Configuration:   â€¢ Available devices: 1   â€¢ Default device: TFRT_CPU_0   â€¢ GPU available: False   ðŸ’» CPU training (consider GPU for faster training)ðŸƒ Starting Training...   â€¢ Physics constraints will guide the training process   â€¢ Uncertainty estimation via deep ensemble   â€¢ Early stopping based on validation loss   â€¢ Results saved to: /pscratch/sd/l/lindajin/DH_profile_kSZ_WL/trained_gp_models/physics_nn_20250910_223458ðŸ”¬ Training Physics-Informed Neural Network  - Dataset: 50 samples  - Features: 115  - Targets: 21 radius bins  - Physics constraints: Mass scaling, Cosmology attention, PK suppression  - Training config: 1000 epochs, 200 patienceðŸš€ Model initialized:  - Architecture: Physics-informed single  - Physics constraints: False, False, False  - Uncertainty method: singleTraining:   0%|                                                                                                         | 0/1000 [00:00<?, ?it/s]Training:   0%|                                                                                               | 1/1000 [00:05<1:25:11,  5.12s/it]Training:   0%|â–                                                                                                | 4/1000 [00:05<16:38,  1.00s/it]Training:   1%|â–‹                                                                                                | 7/1000 [00:05<08:03,  2.05it/s]Training:   1%|â–‰                                                                                               | 10/1000 [00:05<04:50,  3.41it/s]Training:   1%|â–ˆâ–                                                                                              | 13/1000 [00:05<03:14,  5.08it/s]Training:   2%|â–ˆâ–Œ                                                                                              | 16/1000 [00:05<02:19,  7.06it/s]Training:   2%|â–ˆâ–Š                                                                                              | 19/1000 [00:05<01:45,  9.27it/s]Training:   2%|â–ˆâ–ˆ                                                                                              | 22/1000 [00:05<01:25, 11.45it/s]Training:   2%|â–ˆâ–ˆâ–                                                                                             | 25/1000 [00:06<01:10, 13.74it/s]Training:   3%|â–ˆâ–ˆâ–‹                                                                                             | 28/1000 [00:06<01:01, 15.90it/s]Training:   3%|â–ˆâ–ˆâ–‰                                                                                             | 31/1000 [00:06<00:54, 17.81it/s]Training:   3%|â–ˆâ–ˆâ–ˆâ–Ž                                                                                            | 34/1000 [00:06<00:49, 19.42it/s]Training:   4%|â–ˆâ–ˆâ–ˆâ–Œ                                                                                            | 37/1000 [00:06<00:46, 20.69it/s]Training:   4%|â–ˆâ–ˆâ–ˆâ–Š                                                                                            | 40/1000 [00:06<00:44, 21.65it/s]Training:   4%|â–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                           | 43/1000 [00:06<00:42, 22.41it/s]Training:   5%|â–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                           | 46/1000 [00:06<00:41, 22.97it/s]Training:   5%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹                                                                                           | 49/1000 [00:07<00:40, 23.40it/s]Epoch   50: Train=10000.011719, Val=inf, Physics=0.012148, Time=0.0hTraining:   5%|â–ˆâ–ˆâ–ˆâ–ˆâ–‰                                                                                           | 52/1000 [00:07<00:39, 23.72it/s]Training:   6%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž                                                                                          | 55/1000 [00:07<00:39, 23.95it/s]Training:   6%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ                                                                                          | 58/1000 [00:07<00:39, 24.11it/s]Training:   6%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                                                          | 61/1000 [00:07<00:38, 24.22it/s]Training:   6%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                         | 64/1000 [00:07<00:38, 24.15it/s]Training:   7%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                         | 67/1000 [00:07<00:38, 24.19it/s]Training:   7%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                                                                                         | 70/1000 [00:07<00:38, 24.13it/s]Training:   7%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                                                         | 73/1000 [00:08<00:38, 24.21it/s]Training:   8%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž                                                                                        | 76/1000 [00:08<00:38, 24.26it/s]Training:   8%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ                                                                                        | 79/1000 [00:08<00:37, 24.31it/s]Training:   8%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                                                        | 82/1000 [00:08<00:37, 24.33it/s]Training:   8%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                       | 85/1000 [00:08<00:37, 24.36it/s]Training:   9%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                       | 88/1000 [00:08<00:37, 24.36it/s]Training:   9%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                                                                                       | 91/1000 [00:08<00:37, 24.37it/s]Training:   9%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                                                       | 94/1000 [00:08<00:37, 24.40it/s]Training:  10%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž                                                                                      | 97/1000 [00:09<00:36, 24.41it/s]Epoch  100: Train=10000.013672, Val=inf, Physics=0.013771, Time=0.0hTraining:  10%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ                                                                                     | 100/1000 [00:09<00:36, 24.44it/s]Training:  10%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                                                     | 103/1000 [00:09<00:36, 24.40it/s]Training:  11%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                                                     | 106/1000 [00:09<00:36, 24.43it/s]Training:  11%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž                                                                                    | 109/1000 [00:09<00:36, 24.14it/s]Training:  11%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                                                                                    | 112/1000 [00:09<00:36, 24.21it/s]Training:  12%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰                                                                                    | 115/1000 [00:09<00:36, 24.31it/s]Training:  12%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                   | 118/1000 [00:09<00:36, 24.35it/s]Training:  12%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                   | 121/1000 [00:10<00:36, 24.37it/s]Training:  12%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                                                   | 124/1000 [00:10<00:35, 24.40it/s]Training:  13%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                                                   | 127/1000 [00:10<00:35, 24.42it/s]Training:  13%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž                                                                                  | 130/1000 [00:10<00:35, 24.41it/s]Training:  13%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                                                                                  | 133/1000 [00:10<00:35, 24.43it/s]Training:  14%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰                                                                                  | 136/1000 [00:10<00:35, 24.40it/s]Training:  14%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                 | 139/1000 [00:10<00:35, 24.41it/s]Training:  14%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                 | 142/1000 [00:10<00:35, 24.42it/s]Training:  14%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                                                 | 145/1000 [00:11<00:35, 24.42it/s]Training:  15%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                                                 | 148/1000 [00:11<00:34, 24.44it/s]Epoch  150: Train=10000.013672, Val=inf, Physics=0.013547, Time=0.0hTraining:  15%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž                                                                                | 151/1000 [00:11<00:34, 24.42it/s]Training:  15%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                                                                                | 154/1000 [00:11<00:34, 24.43it/s]Training:  16%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰                                                                                | 157/1000 [00:11<00:34, 24.43it/s]Training:  16%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                               | 160/1000 [00:11<00:34, 24.13it/s]Training:  16%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                               | 163/1000 [00:11<00:34, 24.17it/s]Training:  17%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                                               | 166/1000 [00:11<00:34, 24.23it/s]Training:  17%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                                               | 169/1000 [00:12<00:34, 24.28it/s]Training:  17%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž                                                                              | 172/1000 [00:12<00:34, 24.33it/s]Training:  18%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                                                                              | 175/1000 [00:12<00:33, 24.36it/s]Training:  18%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰                                                                              | 178/1000 [00:12<00:33, 24.40it/s]Training:  18%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                             | 181/1000 [00:12<00:33, 24.41it/s]Training:  18%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                             | 184/1000 [00:12<00:33, 24.43it/s]Training:  19%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                                             | 187/1000 [00:12<00:33, 24.39it/s]Training:  19%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                                             | 190/1000 [00:12<00:33, 24.40it/s]Training:  19%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž                                                                            | 193/1000 [00:13<00:33, 24.41it/s]Training:  20%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ                                                                            | 196/1000 [00:13<00:33, 24.20it/s]Training:  20%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰                                                                            | 199/1000 [00:13<00:33, 24.09it/s]Early stopping at epoch 200Training:  20%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰                                                                            | 199/1000 [00:13<00:53, 14.96it/s]âœ… Training completed in 0.0 hours   Best validation loss: inf   Final test MAPE: 100.0%/pscratch/sd/l/lindajin/DH_profile_kSZ_WL/examples/../src/models/physics_neural_trainer.py:561: RuntimeWarning: invalid value encountered in subtract  val_improvement = np.maximum.accumulate(val_loss[0] - val_loss)âœ… Training Complete!   â€¢ Training time: 0.0 hours   â€¢ Best validation loss: inf   â€¢ Final test MAPE: 100.0%   â€¢ Test RÂ²: -0.639ðŸ“Š Performance vs GP Expectations:   âš ï¸  NN MAPE (100.0%) higher than GP range (29.1-35.0%)      Consider: More physics constraints, larger ensemble, more training dataðŸ“Š Training Efficiency Measurement==================================================ðŸ”¬ Efficiency Comparison:   GP (Hierarchical):     1360 samples in  42.5 min = 32.0 samples/min   NN (Physics):          3400 samples in   0.2 min = 15325.3 samples/min   Efficiency ratio:     478.9x ðŸš€ NN fasterâš–ï¸  Scaling Analysis:   Data scaling:         2.5x more samples   Time scaling:         0.0x longer training   Efficiency gain:      478.9x better data/time ratioðŸŽ¯ Apple-to-Apple Test Accuracy Comparison:   GP Best (Multiscale):    80.7% test MAPE   NN (Physics):            100.0% test MAPE   Test accuracy ratio:     1.24 âŒ WorseðŸ“ˆ Overfitting Analysis:   GP (Hierarchical): 29.1% â†’ 100.0% (3.4x overfitting)   NN (Physics):      100.0% â†’ 100.0% (1.0x âœ… Good)ðŸ† Overall Performance (MAPEÃ—time/sample, lower=better):   GP score:             2.5203   NN score:             0.0065   Overall improvement:  386.2x ðŸŽ‰ NN betterðŸ’¡ Efficiency Summary:   âš–ï¸  MIXED: Consider specific use case (scalability vs speed)ðŸ”® Making Predictions:   â€¢ Prediction shape: (3, 21)   â€¢ Uncertainty available: Yes   â€¢ Average uncertainty: 1.1163ðŸ’¾ Configuration saved to: /pscratch/sd/l/lindajin/DH_profile_kSZ_WL/trained_gp_models/physics_nn_20250910_223458/training_config.jsonâœ… Complete! Efficiency vs GP: 478.9x